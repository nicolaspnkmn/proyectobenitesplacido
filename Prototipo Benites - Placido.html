<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Predicción de Impresión — Prototipo Web</title>

<!-- Chart.js para la gráfica -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
  :root{
    /* Paleta pastel basada en el logo */
    --blue-pastel: #cfe6ff;     /* fondo app (pastel, no intenso) */
    --blue-ui:     #a9d6ff;     /* superficies suaves */
    --blue-strong: #1e88e5;     /* detalles/bordes sutiles */
    --cyan:        #34c6f3;
    --teal:        #11a8a0;
    --lime:        #b9d33a;
    --orange:      #f57c00;
    --red:         #e64a4a;

    --ink-900: #06223b;
    --ink-700: #164369;
    --ink-600: #2c5b84;
    --ink-500: #3a6a97;
    --ink-300: #6e9bc2;
    --ink-100: #e8f2ff;

    --card-bg: #f5faff;       /* tarjetas */
    --card-stroke: #b7d4f9;
    --chip-ok-bg: #d7f7ef;
    --chip-ok-fg: #0d574f;
    --chip-bad-bg:#ffe0dd;
    --chip-bad-fg:#7a1b14;

    --shadow: 0 6px 22px rgba(30,136,229,.15);
    --radius: 14px;

    /* Scroll agradable */
    --scroll-track: #d8eaff;
    --scroll-thumb: #9cc9ff;
    --scroll-thumb-hover: #7fb6ff;
  }

  *{ box-sizing:border-box; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

  body{
    margin:0; background:var(--blue-pastel); color:var(--ink-900);
  }

  .app{
    padding:18px 16px 28px;
    max-width:1400px; margin:0 auto;
  }

  header{
    display:flex; align-items:center; gap:12px; flex-wrap:wrap;
    margin-bottom:14px;
  }
  header .title{
    font-size:20px; font-weight:800; color:var(--ink-900);
  }
  .pill{
    border:1px solid var(--blue-strong); color:var(--ink-700);
    background:#e9f3ff; padding:6px 10px; border-radius:999px; font-weight:600;
  }
  .spacer{ flex:1 1 auto; }

  .op-row{
    display:flex; align-items:center; gap:8px; min-width:320px;
  }
  select, input[type="text"], input[type="number"]{
    background:white; border:1px solid var(--card-stroke);
    border-radius:10px; padding:10px 12px; outline:none; width:100%;
  }
  select:focus, input:focus{ border-color:var(--blue-strong); box-shadow:0 0 0 3px rgba(30,136,229,.15); }

  .layout{
    display:grid; grid-template-columns: 1fr 1.2fr; gap:16px;
  }

  /* Panel izquierdo con scroll tipo Excel */
  .left-scroll{
    background:var(--card-bg); border:1px solid var(--card-stroke); border-radius:var(--radius);
    box-shadow:var(--shadow); max-height: calc(100vh - 150px); overflow:auto;
  }
  /* Scroll personal */
  .left-scroll::-webkit-scrollbar{ width:14px; }
  .left-scroll::-webkit-scrollbar-track{ background:var(--scroll-track); border-radius:8px; }
  .left-scroll::-webkit-scrollbar-thumb{ background:var(--scroll-thumb); border-radius:8px; }
  .left-scroll::-webkit-scrollbar-thumb:hover{ background:var(--scroll-thumb-hover); }

  .card{
    background:var(--card-bg); border:1px solid var(--card-stroke); border-radius:var(--radius); box-shadow:var(--shadow);
  }
  .card h3{
    margin:0; padding:10px 14px; color:var(--ink-700); font-size:13px; letter-spacing:.4px;
    border-bottom:1px solid var(--card-stroke); background:linear-gradient(#f7fbff,#eef6ff);
    border-top-left-radius:var(--radius); border-top-right-radius:var(--radius);
    text-transform:uppercase;
  }
  .section{ padding:12px; }

  .form-grid{
    display:grid; grid-template-columns: 220px 1fr; gap:10px; align-items:center;
  }
  .chip{
    display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; font-weight:800; font-size:13px;
  }
  .chip.ok   { background:var(--chip-ok-bg); color:var(--chip-ok-fg); }
  .chip.bad  { background:var(--chip-bad-bg); color:var(--chip-bad-fg); }
  .kpis{ display:flex; gap:16px; align-items:center; font-weight:700; color:var(--ink-700); }

  .result-row{ display:flex; align-items:center; gap:10px; }
  .big-de{ font-size:40px; font-weight:900; color:var(--teal); letter-spacing:.5px; }

  .alerts{ display:flex; flex-direction:column; gap:6px; }
  .alert{ background:#fff7e8; border:1px solid #ffd9a6; color:#8a5c0e; border-radius:9px; padding:6px 10px; font-size:13px; }

  .sensors-table{
    width:100%; border-collapse:collapse; font-size:13px;
  }
  .sensors-table th, .sensors-table td{
    border-bottom:1px solid var(--card-stroke); padding:8px 10px;
  }
  .sensors-table th{ text-align:left; color:var(--ink-600); background:#eef6ff; }

  .btn-row{
    display:flex; justify-content:flex-end; gap:10px; padding:12px 0 4px;
  }
  .btn{
    border:0; border-radius:11px; padding:10px 14px; font-weight:800; cursor:pointer;
    transition:transform .06s ease, filter .06s ease;
  }
  .btn:active{ transform:translateY(1px); filter:brightness(.95); }
  .btn.primary{ background:var(--teal); color:white; }
  .btn.warn{ background:var(--orange); color:white; }
  .btn.soft{ background:#e7f7ff; color:var(--ink-700); border:1px solid var(--card-stroke); }

  @media (max-width: 1120px){
    .layout{ grid-template-columns: 1fr; }
    .left-scroll{ max-height:none; }
  }

  /* Minichips dot */
  .dot{
    width:10px; height:10px; border-radius:5px; display:inline-block; background:#9bb6c9;
  }
  .ok   { background:#1ED7A5 !important; }
  .warn { background:#FFC65A !important; }
  .err  { background:#FF6B6B !important; }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">PREDICCIÓN PARA UNA CORRECTA IMPRESIÓN — LITHRONE 28</div>
      <span class="pill">UI demo (modelo real)</span>
      <div class="spacer"></div>

      <div class="op-row">
        <label for="opSel" style="font-weight:700;color:#0a3258;">OP:</label>
        <select id="opSel"></select>
        <label style="font-weight:700;color:#0a3258;">Descripción:</label>
        <input id="opDesc" type="text" readonly placeholder="Descripción de OP" />
      </div>
      <span class="pill">CMYK · 4C · Pantones=0</span>
    </header>

    <div class="layout">
      <!-- Columna izquierda con scroll -->
      <div class="left-scroll">
        <div class="card">
          <h3>PLANIFICACIÓN (antes de imprimir)</h3>
          <div class="section form-grid" id="planGrid">
            <!-- cada label + input -->
            <label>Código producto</label><input id="codProducto" type="text" placeholder="Código de producto (si es repetitivo)">

            <label>material cat</label>
            <select id="materialCat">
              <option>estucado</option><option>no estucado</option><option>dúplex</option>
            </select>

            <label>Material</label><input id="material" type="text" value="COUCHE MATE 350 GR. ASIATICO">

            <label>cov C (%)</label><input type="number" id="covC" value="45">
            <label>cov M (%)</label><input type="number" id="covM" value="45">
            <label>cov Y (%)</label><input type="number" id="covY" value="35">
            <label>cov K (%)</label><input type="number" id="covK" value="55">
            <label>cov spot sum (%)</label><input type="number" id="covSpot" value="0">
            <label>TAC (%)</label><input type="number" id="tac" value="180">
            <label>gramaje gsm (gsm)</label><input type="number" id="gramaje" value="300">
          </div>
        </div>

        <div class="card" style="margin-top:12px;">
          <h3>ARRANQUE (sensores en máquina)</h3>
          <div class="section form-grid" id="runGrid">
            <label>temp ambiente C (°C)</label><input type="number" id="tAmb" value="28.0" step="0.1">
            <label>RH ambiente  (%)</label><input type="number" id="rh" value="50">
            <label>speed IPH (hojas/h)</label><input type="number" id="iph" value="9000">
            <label>temp cuerpo1 C (°C)</label><input type="number" id="t1" value="35.0" step="0.1">
            <label>temp cuerpo2 C (°C)</label><input type="number" id="t2" value="35.5" step="0.1">
            <label>temp cuerpo3 C (°C)</label><input type="number" id="t3" value="36.2" step="0.1">
            <label>temp cuerpo4 C (°C)</label><input type="number" id="t4" value="36.0" step="0.1">
            <label>num pliegos prueba (pliegos)</label><input type="number" id="pliegos" value="500">
            <label>dens C</label><input type="number" id="dC" value="1.40" step="0.01">
            <label>dens M</label><input type="number" id="dM" value="1.40" step="0.01">
            <label>dens Y</label><input type="number" id="dY" value="1.00" step="0.01">
            <label>dens K</label><input type="number" id="dK" value="1.70" step="0.01">
          </div>
        </div>
      </div>

      <!-- Columna derecha -->
      <div style="display:flex;flex-direction:column;gap:12px;">
        <div class="card">
          <h3>Resultado</h3>
          <div class="section">
            <div class="result-row">
              <span class="dot ok"></span>
              <div class="big-de" id="deOut">—</div>
              <span id="chip" class="chip ok">Adecuada</span>
            </div>
            <div style="color:#255984;font-weight:700;margin:6px 0;">ΔE predicho (modelo). Umbral utilizado: 3.0</div>
            <div class="alerts" id="alerts"></div>
          </div>
        </div>

        <div class="card">
          <h3>Desempeño del modelo (último mes)</h3>
          <div class="section">
            <div class="kpis">
              <div id="kpiPrec">Precisión: —</div>
              <div id="kpiMae">MAE ΔE: —</div>
            </div>
            <canvas id="chart" height="160"></canvas>
          </div>
        </div>

        <div class="card">
          <h3>Sensores K4 — Estado de conectividad</h3>
          <div class="section">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
              <button id="btnConn" class="btn soft">Conectar</button>
              <span class="dot" id="allDot"></span>
              <span id="connTxt" style="color:#2b5976;">Desconectado</span>
            </div>
            <table class="sensors-table" id="sensTbl">
              <thead><tr><th>Sensor</th><th>Valor</th></tr></thead>
              <tbody>
                <tr><td>Ambiente (T/HR)</td><td id="sAmb">—</td></tr>
                <tr><td>Cuerpo 1 (°C)</td><td id="s1">—</td></tr>
                <tr><td>Cuerpo 2 (°C)</td><td id="s2">—</td></tr>
                <tr><td>Cuerpo 3 (°C)</td><td id="s3">—</td></tr>
                <tr><td>Cuerpo 4 (°C)</td><td id="s4">—</td></tr>
                <tr><td>Densitómetro</td><td id="sD">—</td></tr>
              </tbody>
            </table>

            <div class="btn-row">
              <button class="btn soft"   id="btnTest">Prueba</button>
              <button class="btn primary" id="btnPred">Predecir</button>
              <button class="btn warn"    id="btnReset">Reiniciar gráfica</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ---------- Datos mock de OP -> descripción ---------- */
const OP_DATA = [
  { op: "37090", desc: "FOLLETO GLUTAPAK SR 8 PAG 21 x 21" },
  { op: "37031", desc: "CAJA MEDICINAL 4C · LOTE 2025" },
  { op: "33525", desc: "PACKAGING COSMÉTICO — EDICIÓN" },
  { op: "42001", desc: "TARJETA PUBLICITARIA CMYK" }
];

const opSel  = document.getElementById('opSel');
const opDesc = document.getElementById('opDesc');
OP_DATA.forEach(x=>{
  const o = document.createElement('option'); o.value = x.op; o.textContent = x.op;
  opSel.appendChild(o);
});
opSel.addEventListener('change', ()=>{
  const f = OP_DATA.find(x=>x.op===opSel.value);
  opDesc.value = f? f.desc : '';
});
opSel.value = OP_DATA[0].op; opSel.dispatchEvent(new Event('change'));

/* ---------- Sensores demo ---------- */
let connected=false, timer=null;
const btnConn = document.getElementById('btnConn');
const connTxt = document.getElementById('connTxt');
const allDot  = document.getElementById('allDot');

btnConn.onclick = ()=>{
  connected = !connected;
  btnConn.textContent = connected? 'Desconectar' : 'Conectar';
  connTxt.textContent = connected? 'Conectado' : 'Desconectado';
  allDot.className = 'dot ' + (connected? 'ok':'');
  if(connected){
    tickSensors();
    timer = setInterval(tickSensors, 1500);
  } else {
    clearInterval(timer);
  }
};

function rnd(a,b,fix=1){ return (a + Math.random()*(b-a)).toFixed(fix); }
function tickSensors(){
  setVal('sAmb', `${rnd(24,34)} °C / ${rnd(45,78,0)} %`);
  setVal('s1',  rnd(31,40));
  setVal('s2',  rnd(31,40));
  setVal('s3',  rnd(31,40));
  setVal('s4',  rnd(31,40));
  setVal('sD',  Math.random()>0.1 ? 'OK':'—');
}
function setVal(id, t){ document.getElementById(id).textContent=t; }

/* ---------- Gráfica (pred vs real) ---------- */
const ctx = document.getElementById('chart');
let chart = new Chart(ctx,{
  type:'line',
  data:{ labels:[], datasets:[
    { label:'ΔE predicho', data:[], tension:.3, borderWidth:3, pointRadius:4 },
    { label:'ΔE real',     data:[], tension:.3, borderDash:[6,6], borderWidth:3, pointRadius:3 }
  ]},
  options:{
    responsive:true,
    plugins:{ legend:{ labels:{ color:'#0a3258', font:{ weight:700 } } } },
    scales:{
      x:{ ticks:{ color:'#2b5976' }, grid:{ color:'#e3f0ff' } },
      y:{ ticks:{ color:'#2b5976' }, grid:{ color:'#e3f0ff' } }
    }
  }
});
function pushPoint(pred, real){
  const ts = new Date().toLocaleTimeString();
  chart.data.labels.push(ts);
  chart.data.datasets[0].data.push(pred);
  chart.data.datasets[1].data.push(real);
  chart.update();
}
document.getElementById('btnReset').onclick = ()=>{
  chart.data.labels = [];
  chart.data.datasets.forEach(d=>d.data=[]);
  chart.update();
  document.getElementById('kpiPrec').textContent = 'Precisión: —';
  document.getElementById('kpiMae').textContent  = 'MAE ΔE: —';
};

/* ---------- Predicción demo ---------- */
const btnTest = document.getElementById('btnTest');
const btnPred = document.getElementById('btnPred');
const deOut   = document.getElementById('deOut');
const chip    = document.getElementById('chip');
const alerts  = document.getElementById('alerts');

btnTest.onclick = ()=>{
  // precargar valores sugeridos y disparar una predicción
  document.getElementById('covC').value=45;
  document.getElementById('covM').value=45;
  document.getElementById('covY').value=35;
  document.getElementById('covK').value=55;
  document.getElementById('covSpot').value=0;
  document.getElementById('tac').value=180;
  document.getElementById('gramaje').value=300;

  document.getElementById('tAmb').value= rnd(26,33);
  document.getElementById('rh').value  = rnd(50,78,0);
  document.getElementById('iph').value = 9000;
  ['t1','t2','t3','t4'].forEach((k,i)=>document.getElementById(k).value=rnd(32,39));

  ['dC','dM','dY','dK'].forEach((k)=>document.getElementById(k).value=rnd(1.25,1.8));
  document.getElementById('pliegos').value = 500;

  predict();
};

btnPred.onclick = predict;

function predict(){
  // demo: “modelo” simplificado que usa algunas entradas para construir un ΔE pseudo-realista
  const tAmb = parseFloat(document.getElementById('tAmb').value||0);
  const rh   = parseFloat(document.getElementById('rh').value||0);
  const dK   = parseFloat(document.getElementById('dK').value||0);
  const tac  = parseFloat(document.getElementById('tac').value||0);

  // función inventada sólo para demo
  let de = 1.5 + 0.03*(tAmb-26) + 0.02*(rh-55) + 0.25*Math.max(0,dK-1.7) + 0.005*Math.max(0,tac-180);
  de = Math.max(0.6, Math.min(6, de + (Math.random()-.5)*0.15)); // ruido pequeño

  deOut.textContent = de.toFixed(2);
  const adecuada = de <= 3.0;
  chip.className = 'chip ' + (adecuada? 'ok' : 'bad');
  chip.textContent = adecuada? 'Adecuada' : 'No adecuada';

  // alertas
  alerts.innerHTML = '';
  if(tAmb >= 28) addAlert('Ambiente ≥ 28.0 °C');
  if(rh   >= 65) addAlert('Humedad ≥ 65.0 %');
  const t1=parseFloat(document.getElementById('t1').value||0);
  const t2=parseFloat(document.getElementById('t2').value||0);
  const t3=parseFloat(document.getElementById('t3').value||0);
  const t4=parseFloat(document.getElementById('t4').value||0);
  if([t1,t2,t3,t4].some(t=>t>=38)) addAlert('Temperatura de cuerpos ≥ 38.0 °C');

  // simular valor real cercano (para ver la curva)
  const real = Math.max(0.6, Math.min(6, de + (Math.random()-.5)*0.4));
  pushPoint(de, real);

  // KPIs demo
  const preds = chart.data.datasets[0].data;
  const reals = chart.data.datasets[1].data;
  if(preds.length >= 3){
    const mae = preds.reduce((a,v,i)=>a+Math.abs(v-reals[i]),0)/preds.length;
    const prec = preds.reduce((acc,v,i)=> acc + ((v<=3) === (reals[i]<=3) ? 1:0), 0) / preds.length;
    document.getElementById('kpiPrec').textContent = `Precisión: ${(prec*100).toFixed(1)}%`;
    document.getElementById('kpiMae').textContent  = `MAE ΔE: ${mae.toFixed(3)}`;
  }
}

function addAlert(t){
  const div=document.createElement('div'); div.className='alert'; div.textContent='⚠️  '+t; alerts.appendChild(div);
}
</script>
</body>
</html>
